steps:

# Build the Docker image
- name: 'gcr.io/cloud-builders/docker'
  args: [ 'build',  -t', 'gcr.io/$PROJECT_ID/sport-app-angular$SHORT_SHA', '–build-arg', 'GENERATE_SOURCE_MAP=${_GENERATE_SOURCE_MAP}', '–build-arg', 'REACT_APP_MODULE_NAME=${_REACT_APP_MODULE_NAME}', '–build-arg', 'REACT_APP_API_URL=${_REACT_APP_API_URL}', '–build-arg', 'SKIP_PREFLIGHT_CHECK=${_SKIP_PREFLIGHT_CHECK}', '.']

# Push the Docker image to Google Container Registry
- name: 'gcr.io/cloud-builders/docker'
  args: [ 'push', 'gcr.io/$PROJECT_ID/sport-app-angular:$SHORT_SHA' ]

# Deploy to Cloud Run
- name: 'gcr.io/cloud-builders/gcloud'
  args: [ 'run', 'deploy', 'sport-app-angular', '–image', 'gcr.io/$PROJECT_ID/sport-app-angular:$SHORT_SHA', '–platform', 'managed', '–region', 'us-central1', '–allow-unauthenticated', '–port', '8080', '–timeout' , '900']
